<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Demonstration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h2 {
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .result {
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <h1>API Demonstration, in the last api, pls check your gmail in THE SPAM OR ALL EMAIL</h1>
    
    <!-- Section 1: Get all product categories -->
    <div class="section">
        <h2>1. Get All Product Categories</h2>
        <button onclick="getCategories()">Get Categories</button>
        <div class="result" id="categoriesResult"></div>
    </div>
    
    <!-- Section 2: Get products by category -->
    <div class="section">
        <h2>2. Get Products by Category</h2>
        <div class="form-group">
            <label for="categoryId">Category ID:</label>
            <input type="text" id="categoryId" placeholder="Enter category ID">
        </div>
        <button onclick="getProductsByCategory()">Get Products</button>
        <div class="result" id="productsByCategoryResult"></div>
    </div>
    
    <!-- Section 3: Search products with filters -->
    <div class="section">
        <h2>3. Search Products with Filters</h2>
        <div class="form-group">
            <label for="keyword">Keyword:</label>
            <input type="text" id="keyword" placeholder="Search by name or address">
        </div>
        <div class="form-group">
            <label for="minPrice">Min Price:</label>
            <input type="number" id="minPrice" placeholder="Minimum price">
        </div>
        <div class="form-group">
            <label for="maxPrice">Max Price:</label>
            <input type="number" id="maxPrice" placeholder="Maximum price">
        </div>
        <div class="form-group">
            <label for="color">Color:</label>
            <input type="text" id="color" placeholder="Filter by color">
        </div>
        <div class="form-group">
            <label for="size">Size:</label>
            <input type="text" id="size" placeholder="Filter by size">
        </div>
        <button onclick="searchProducts()">Search Products</button>
        <div class="result" id="searchProductsResult"></div>
    </div>
    
    <!-- Section 4: Create new user -->
    <div class="section">
        <h2>4. Create New User</h2>
        <div class="form-group">
            <label for="userName">Name:</label>
            <input type="text" id="userName" placeholder="User name">
        </div>
        <div class="form-group">
            <label for="userEmail">Email:</label>
            <input type="email" id="userEmail" placeholder="User email">
        </div>
        <div class="form-group">
            <label for="userPhone">Phone:</label>
            <input type="text" id="userPhone" placeholder="User phone">
        </div>
        <div class="form-group">
            <label for="userProvince">Province:</label>
            <input type="text" id="userProvince" placeholder="Province">
        </div>
        <div class="form-group">
            <label for="userDistrict">District:</label>
            <input type="text" id="userDistrict" placeholder="District">
        </div>
        <div class="form-group">
            <label for="userComune">Comune:</label>
            <input type="text" id="userComune" placeholder="Comune">
        </div>
        <div class="form-group">
            <label for="userAddress">Address:</label>
            <input type="text" id="userAddress" placeholder="Address">
        </div>
        <div class="form-group">
            <label for="userHousingType">Housing Type:</label>
            <input type="text" id="userHousingType" placeholder="Housing type">
        </div>
        <button onclick="createUser()">Create User</button>
        <div class="result" id="createUserResult"></div>
    </div>
    
    <!-- Section 5: Create new product -->
    <div class="section">
        <h2>5. Create New Product</h2>
        <div class="form-group">
            <label for="productName">Name:</label>
            <input type="text" id="productName" placeholder="Product name">
        </div>
        <div class="form-group">
            <label for="productPrice">Price:</label>
            <input type="number" id="productPrice" placeholder="Product price">
        </div>
        <div class="form-group">
            <label for="productSize">Size:</label>
            <input type="text" id="productSize" placeholder="Product size">
        </div>
        <div class="form-group">
            <label for="productQuantity">Quantity:</label>
            <input type="number" id="productQuantity" placeholder="Product quantity">
        </div>
        <div class="form-group">
            <label for="productColor">Color:</label>
            <input type="text" id="productColor" placeholder="Product color">
        </div>
        <div class="form-group">
            <label for="productCategory">Category ID:</label>
            <input type="text" id="productCategory" placeholder="Category ID">
        </div>
        <button onclick="createProduct()">Create Product</button>
        <div class="result" id="createProductResult"></div>
    </div>
    
    <!-- Section 6: Create new order -->
    <div class="section">
        <h2>6. Create New Order</h2>
        <div class="form-group">
            <label for="orderUserId">User ID:</label>
            <input type="text" id="orderUserId" placeholder="User ID">
        </div>
        <div class="form-group">
            <label for="orderPaymentOnline">Payment Online (true/false):</label>
            <select id="orderPaymentOnline">
                <option value="true">True</option>
                <option value="false">False</option>
            </select>
        </div>
        <div class="form-group">
            <label>Order Items (JSON format):</label>
            <textarea id="orderItems" rows="4" style="width: 100%;" placeholder='[{"productId": 1, "quantity": 2}, {"productId": 3, "quantity": 1}]'></textarea>
        </div>
        <button onclick="createOrder()">Create Order</button>
        <div class="result" id="createOrderResult"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api';
        
        // Helper function to display results
        function displayResult(elementId, data) {
            const resultElement = document.getElementById(elementId);
            resultElement.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        
        // 1. Get all product categories
        async function getCategories() {
            try {
                const response = await fetch(`${API_BASE_URL}/categories`);
                const data = await response.json();
                displayResult('categoriesResult', data);
            } catch (error) {
                console.error('Error:', error);
                displayResult('categoriesResult', { error: 'Failed to fetch categories' });
            }
        }
        
        // 2. Get products by category
        async function getProductsByCategory() {
            const categoryId = document.getElementById('categoryId').value;
            if (!categoryId) {
                alert('Please enter a category ID');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/categories/${categoryId}/products`);
                const data = await response.json();
                displayResult('productsByCategoryResult', data);
            } catch (error) {
                console.error('Error:', error);
                displayResult('productsByCategoryResult', { error: 'Failed to fetch products by category' });
            }
        }
        
        // 3. Search products with filters
        async function searchProducts() {
            const keyword = document.getElementById('keyword').value;
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            const color = document.getElementById('color').value;
            const size = document.getElementById('size').value;
            
            let url = `${API_BASE_URL}/products/search?`;
            if (keyword) url += `keyword=${encodeURIComponent(keyword)}&`;
            if (minPrice) url += `minPrice=${encodeURIComponent(minPrice)}&`;
            if (maxPrice) url += `maxPrice=${encodeURIComponent(maxPrice)}&`;
            if (color) url += `color=${encodeURIComponent(color)}&`;
            if (size) url += `size=${encodeURIComponent(size)}&`;
            
            // Remove trailing & or ? if no params
            url = url.replace(/[&?]$/, '');
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                displayResult('searchProductsResult', data);
            } catch (error) {
                console.error('Error:', error);
                displayResult('searchProductsResult', { error: 'Failed to search products' });
            }
        }
        
        // 4. Create new user
        async function createUser() {
            const userData = {
                name: document.getElementById('userName').value,
                email: document.getElementById('userEmail').value,
                phone: document.getElementById('userPhone').value,
                province: document.getElementById('userProvince').value,
                district: document.getElementById('userDistrict').value,
                comune: document.getElementById('userComune').value,
                address: document.getElementById('userAddress').value,
                housing_type: document.getElementById('userHousingType').value
            };
            
            if (!userData.name || !userData.email) {
                alert('Name and email are required');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/users`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });
                const data = await response.json();
                displayResult('createUserResult', data);
            } catch (error) {
                console.error('Error:', error);
                displayResult('createUserResult', { error: 'Failed to create user' });
            }
        }
        
        // 5. Create new product
        async function createProduct() {
            const productData = {
                name: document.getElementById('productName').value,
                price: document.getElementById('productPrice').value,
                size: document.getElementById('productSize').value,
                quantity: document.getElementById('productQuantity').value,
                color: document.getElementById('productColor').value,
                categoryid: document.getElementById('productCategory').value
            };
            
            if (!productData.name || !productData.price || !productData.categoryid) {
                alert('Name, price and category are required');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                });
                const data = await response.json();
                displayResult('createProductResult', data);
            } catch (error) {
                console.error('Error:', error);
                displayResult('createProductResult', { error: 'Failed to create product' });
            }
        }
        
        // 6. Create new order
        async function createOrder() {
            const userId = document.getElementById('orderUserId').value;
            const paymentOnline = document.getElementById('orderPaymentOnline').value === 'true';
            let items;
            
            try {
                items = JSON.parse(document.getElementById('orderItems').value);
            } catch (e) {
                alert('Invalid JSON format for order items');
                return;
            }
            
            if (!userId || !items || items.length === 0) {
                alert('User ID and at least one order item are required');
                return;
            }
            
            const orderData = {
                userId,
                items,
                paymentOnline
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                const data = await response.json();
                displayResult('createOrderResult', data);
            } catch (error) {
                console.error('Error:', error);
                displayResult('createOrderResult', { error: 'Failed to create order' });
            }
        }
    </script>
</body>
</html>